document.addEventListener("DOMContentLoaded",function(){const scaleContainer=document.querySelector(".scale-container"),measurementSpan=document.getElementById("measurementSpan"),measurementForm=document.getElementById("calculator-form"),scaleInstruction=document.getElementById("scale_instruction_content"),syringeVol=document.getElementById("dropdown1"),images=document.querySelectorAll(".image-container img");let units=30;function removeScaleUnits(){scaleContainer.querySelectorAll(".scale-unit").forEach(function(scaleUnit){scaleUnit.parentNode.removeChild(scaleUnit)})}function removeSelectedClass(){images.forEach(function(img){img.classList.remove("selected")})}function createScale(totalUnits,interval){removeScaleUnits();for(let i=0;i<=totalUnits;i++){const scaleUnit=document.createElement("div");if(scaleUnit.classList.add("scale-unit"),scaleUnit.style.width="2px",scaleUnit.style.height="25px",totalUnits===50?scaleContainer.style.gap="1.2vw":scaleContainer.style.gap="1.8vw",i%5===0){scaleUnit.style.height="50px";const label=document.createElement("span");i!==0&&(label.textContent=i),interval===10&&(label.textContent=i*2),scaleUnit.appendChild(label)}scaleContainer.appendChild(scaleUnit)}const measurementSpan2=document.createElement("div");measurementSpan2.id="measurementSpan",scaleContainer.appendChild(measurementSpan2)}createScale(30,5);function updateMeasurementSpan(){let peptideAmt,waterAmt,doseValue;if(document.getElementById("dropdown2").value==="-1"?peptideAmt=parseInt(document.getElementById("dropdown2-custom").value):peptideAmt=parseInt(document.getElementById("dropdown2").value),document.getElementById("dropdown3").value==="-1"?waterAmt=parseFloat(document.getElementById("dropdown3-custom").value):waterAmt=parseFloat(document.getElementById("dropdown3").value),document.getElementById("dropdown4").value==="-1"){var customValue=parseFloat(document.getElementById("dropdown4-custom").value);doseValue=isNaN(customValue)?0:customValue}else doseValue=parseFloat(document.getElementById("dropdown4").value);const syringeValueOnScale=(doseValue/(peptideAmt/(waterAmt*100))).toFixed(1);setTimeout(()=>{const scaleWidth=scaleContainer.clientWidth,spanPosition=syringeValueOnScale/units*scaleWidth;measurementSpan.style.width=spanPosition+"px"},300),parseFloat(syringeValueOnScale)<1?scaleInstruction.textContent=`For ${doseValue}mg, pull to 0 units`:parseFloat(syringeValueOnScale)>units?(scaleInstruction.textContent="Your syringe is too small for that dose.",setTimeout(()=>{measurementSpan.style.width="0px"},300)):scaleInstruction.textContent=`For ${doseValue}mg, pull to ${syringeValueOnScale} units`}updateMeasurementSpan(),measurementForm.querySelectorAll("select").forEach(function(dropdown){dropdown.addEventListener("change",updateMeasurementSpan),dropdown.addEventListener("change",function(){const selectedValue=dropdown.value,customInput=document.getElementById(`${dropdown.id}-custom`);selectedValue==="-1"?customInput.classList.remove("d-none"):(customInput.classList.add("d-none"),updateMeasurementSpan())})}),document.querySelectorAll(".calculator-form input[type='number']").forEach(function(input){input.addEventListener("input",function(){updateMeasurementSpan()})}),syringeVol.addEventListener("change",function(){const selectedValue=parseInt(syringeVol.value);removeSelectedClass(),selectedValue>=1&&selectedValue<=images.length&&images[selectedValue-1].classList.add("selected"),selectedValue===1?(createScale(30,5),units=30,updateMeasurementSpan()):selectedValue===2?(createScale(50,5),units=50,updateMeasurementSpan()):selectedValue===3&&(createScale(50,10),units=100,updateMeasurementSpan())}),images.forEach(function(img,index){img.addEventListener("click",function(){syringeVol.value=index+1,removeSelectedClass(),img.classList.add("selected");const selectedValue=parseInt(syringeVol.value);removeSelectedClass(),selectedValue>=1&&selectedValue<=images.length&&images[selectedValue-1].classList.add("selected"),selectedValue===1?(createScale(30,5),units=30,updateMeasurementSpan()):selectedValue===2?(createScale(50,5),units=50,updateMeasurementSpan()):selectedValue===3&&(createScale(50,10),units=100,updateMeasurementSpan())})})});
